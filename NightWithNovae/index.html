<body style="background-color:1b3c59">
    <canvas id="cc" width="120px" height="180px"></canvas>
    <canvas id="temp" width="15px" height="15px" style="display:none"></canvas>
    <img id="star" src="star.svg" width="10px" style=" display:none">
</body>
<script>
    var cc = document.getElementById('cc');
    var ctemp = document.getElementById('temp');
    var starImg = document.getElementById('star');
    var temp = ctemp.getContext('2d');
    cc = cc.getContext('2d');

    // position zero
    var w = 60;
    var h = 60;
    var tempLength = 15;

    var progress = 0;
    var angle = 1;
    var rad = 50;
    var colors = [
        [0, 102, 255],
        [255, 203, 195],
        [235, 255, 170],
        [162, 178, 110],
        [195, 126, 246],
        [249, 145, 137],
        [192, 251, 148],
        [159, 246, 253],
        [170, 248, 254]
    ];
    var time = Date.now();
    requestAnimationFrame(draw);

    function draw() {
        var now = Date.now()
        var delta = now - time;
        time = now;

        cc.clearRect(0, 0, 120, 180);
        var points = [];
        var setp = 2 * Math.PI / 5;
        for (var i = 0; i < 5; i++) {
            points.push([rad * Math.sin(angle + i * setp), rad * Math.cos(angle + i * setp)])
        }

        if (progress > 5) {
            if (Math.random() > 0.98) {
                addStar();
            }
            for (i in twinkling) {
                twinkling[i].draw(delta, temp, cc);
            }
        }

        cc.save();
        cc.beginPath();

        cc.shadowOffsetX = 0;
        cc.shadowOffsetY = 3;
        cc.shadowBlur = 15;
        cc.shadowColor = `rgba(0, 100, 255, ${progress/8})`;

        cc.lineWidth = 5;
        cc.lineCap = 'round';
        cc.lineJoin = 'round';
        cc.strokeStyle = `rgba(170, 204, 255, ${progress/8})`;
        cc.moveTo(w + points[0][0], h - points[0][1]);
        var point;
        var map = [0, 2, 4, 1, 3, 0];
        for (var i = 0; i < 5; i++) {
            if (progress > i) {
                point = lerp(points[map[i]], points[map[i + 1]], Math.min(progress - i, 1));
                cc.lineTo(w + point[0], h - point[1]);
            }
        }
        cc.stroke();

        cc.strokeStyle = `rgba(170, 204, 255, ${(progress-5)/8})`;
        if (progress > 5) {
            cc.arc(w + 0, h + 0, rad, angle - Math.PI / 2, angle + Math.PI * 1.5,
                false);
        }
        cc.stroke();
        cc.restore();


        // animate
        progress += 0.05;
        progress = progress % 99999999;
        angle += Math.min(0.001 * progress, 0.01);
        requestAnimationFrame(draw);
    }

    // star particle
    var mSize = 5,
        sizeRange = 10,
        mAlpha = .3,
        alphaRange = .7,
        mBlink = 2000,
        blinkRange = 1000,
        start = rad - 10,
        startRange = 10,
        mLife = 5000,
        lifeRange = 2000,
        mSpeed = 20 / (mLife + lifeRange / 2),
        speedRange = 10 / (mLife + lifeRange / 2),
        mAngle = Math.PI / 4,
        angleRange = Math.PI / 2,
        dirRange = Math.PI / 18,
        ridRange = Math.PI / 1500;

    class starObj {
        constructor() {
            this.color = '';
            this.alpha = 0;
            this.size = 0;
            this.life = 0;
            this.age = 0;
            this.blink = 0;
            this.angle = 0;
            this.dirAngle = 0;
            this.start = 0;
            this.pos = 0;
            this.speed = 0;
            this.rotate = 0;
            this.rid = 0;

        }
        reset() {
            var r1 = Math.random();
            this.size = mSize + r1 * sizeRange;
            this.color = Math.floor(Math.random() * colors.length);
            this.alpha = mAlpha + r1 * alphaRange;
            this.start = start + r1 * startRange;
            this.speed = mSpeed + r1 * speedRange;
            this.pos = 0;
            this.life = mLife + Math.random() * lifeRange;
            this.age = 0;
            this.blink = mBlink + Math.random() * blinkRange;
            this.life += this.blink-this.life % this.blink;
            this.angle = mAngle + Math.random() * angleRange;
            this.dirAngle = (1 - Math.random() * 2) * dirRange * Math.abs(1 - Math.PI / 2 / this.angle);
            this.rotate = Math.random() * 2 * Math.PI;
            this.rid = (1 - Math.random() * 2) * ridRange;
        }
        draw(time, tempCv, mainCv) {
            this.pos += this.speed * time;
            this.age += time;
            this.rotate += this.rid * time;
            if (this.age > this.life) {
                return;
            };

            var a = (1-Math.abs(0.5-(this.age % this.blink) / this.blink)) * 2 * this.alpha;
            tempCv.clearRect(0, 0, tempLength, tempLength);
            tempCv.save();
            tempCv.fillStyle = getColor(this.color, a);
            tempCv.fillRect(0, 0, tempLength, tempLength);
            tempCv.globalCompositeOperation = 'destination-in';
            tempCv.drawImage(starImg, 0, 0, this.size, this.size);
            tempCv.restore();

            mainCv.save();
            mainCv.translate(w, h);
            mainCv.rotate(this.angle);
            mainCv.translate(this.start, 0);
            mainCv.rotate(Math.PI / 2 - this.angle);
            mainCv.translate(this.pos, 0);
            mainCv.rotate(this.rotate);
            mainCv.translate(-this.size/2,-this.size/2)
            mainCv.drawImage(ctemp, 0, 0);
            mainCv.restore();
        }
    }

    //star factory
    var twinkling = [];

    function addStar() {
        var star;
        if (twinkling.length < 20) {
            star = new starObj();
        } else {
            star = twinkling.shift();
        }
        star.reset();
        twinkling.push(star);
    }


    // tools
    function lerp(a, b, per) {
        return [((1 - per) * a[0] + per * b[0]), ((1 - per) * a[1] + per * b[1])]
    }

    function getColor(i, alpha) {
        return `rgba(${colors[i][0]},${colors[i][1]},${colors[i][2]},${alpha})`
    }
</script>